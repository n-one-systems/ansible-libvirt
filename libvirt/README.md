# nsys.libvirt Collection

## About This Collection
This Ansible collection provides a comprehensive set of tools for managing libvirt virtualization resources. It is designed to make libvirt management through Ansible more streamlined and robust.

**Important Note**: This collection is primarily (80%) maintained by AI (Claude 3.5 Sonnet), with human oversight and validation. This innovative approach allows for rapid development and maintenance while ensuring quality through human review.

## Features
- Complete VM lifecycle management
- Network creation and configuration
- Storage pool and volume management
- Device attachment handling (networks, storage)
- VM cloning capabilities
- Integration with Molecule testing
- Cloud-init support
- Comprehensive lookup plugins for resource information

## Requirements
- Python >= 3.12
- Ansible >= 2.18.0 < 3.0.0
- libvirt-python >= 10.x
- lxml >= 5.x
- passlib >= 1.x
- Collections:
  - community.general >= 10.0.1, < 11.0.0
  - ansible.posix >= 1.6.0, < 2.0.0

## Installation
```bash
ansible-galaxy collection install nsys.libvirt
```

## Components

### Roles
- **molecule_transformer**: Transforms Molecule configurations into libvirt resources
- **molecule_handler**: Manages libvirt resources for Molecule testing
- **cloud-init-config**: Handles cloud-init configuration for VMs

### Modules
- **domain**: VM management
- **network**: Virtual network management
- **storage_pool**: Storage pool operations
- **libvirt_volume**: Volume management
- **attach_network**: Network interface attachment
- **attach_volume**: Storage attachment
- **clone_domain**: VM cloning
- **domain_power_state**: Power state management

### Lookup Plugins
- **domain_info**: Domain information retrieval
- **network_info**: Network details lookup
- **volumes**: Volume information lookup
- **reserved_ip**: DHCP reservation lookup
- **libvirt_vms**: VM listing by state

## Quick Start

### Create a VM
```yaml
- name: Create a new VM
  nsys.libvirt.domain:
    name: test-vm
    vcpu: 2
    memory: 2048
    state: present
```

### Create a Network
```yaml
- name: Create NAT network
  nsys.libvirt.network:
    name: custom-net
    cidr: 192.168.100.0/24
    dhcp:
      enabled: true
      start: 192.168.100.128
      end: 192.168.100.254
```

# Create a Disk in the Default Pool
```yaml
- name: Create a disk in the default pool
  nsys.libvirt.libvirt_volume:
    name: test-disk
    pool: default
    capacity: 10G
    format: qcow2
```
# Attach a Disk to a VM
```yaml
- name: Attach disk to VM
  nsys.libvirt.attach_volume:
    domain: test-vm
    volume: test-disk
    target: vdb
```
# Attach a Network to a VM
```yaml
- name: Attach network to VM
  nsys.libvirt.attach_network:
    domain: test-vm
    network: custom-net
```
# Start a VM
```yaml
- name: Start VM
  nsys.libvirt.domain_power_state:
    domain: test-vm
    state: running
```


## Molecule Integration
The collection provides deep integration with Molecule for testing:

```yaml
# molecule.yml
platforms:
  - name: test-vm
    type: vm
    memory: 2048
    cpu: 2
    interfaces:
      - network: default
    disks:
      - name: root
        size: 20G
```

## Remote Management
All modules support remote libvirt management:

```yaml
- name: Create VM on remote host
  nsys.libvirt.domain:
    name: remote-vm
    vcpu: 2
    memory: 2048
    remote_host: libvirt1.example.com
    auth_user: admin
    auth_password: secret
```

## Contributing
Contributions are welcome! Please note that this project uses an AI-assisted maintenance model:
1. Issues and feature requests are evaluated by both AI and human maintainers
2. Initial code reviews are performed by AI
3. Final validation and merging is done by human maintainers
4. Documentation is primarily generated by AI with human review

## License
GPL-3.0-or-later

## Support
- Repository: https://github.com/n-one-systems/ansible-collection-libvirt
- Issues: https://github.com/n-one-systems/ansible-collection-libvirt/issues
- Documentation: https://github.com/n-one-systems/ansible-collection-libvirt/tree/main/docs

## Acknowledgments
This collection is primarily maintained using Claude 3.5 Sonnet, an AI assistant from Anthropic. Human oversight and validation is provided by N-One Systems.
