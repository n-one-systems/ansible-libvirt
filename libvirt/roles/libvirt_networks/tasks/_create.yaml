# ./roles/libvirt_networks/tasks/_create.yaml
---
- name: Define libvirt network
  community.libvirt.virt_net:
    name: "{{ network.name }}"
    uri: "{{ uri }}"
    state: present
    xml: '{{ lookup("template", "network-template.xml.j2") }}'
  loop: "{{ networks }}"
  loop_control:
    loop_var: network
    index_var: network_index

- name: Start all libvirt networks
  community.libvirt.virt_net:
    name: "{{ network.name }}"
    uri: "{{ uri }}"
    state: active
  loop: "{{ networks }}"
  loop_control:
    loop_var: network

- name: Ensure all libvirt networks are up on boot
  community.libvirt.virt_net:
    name: "{{ network.name }}"
    uri: "{{ uri }}"
    autostart: true
  loop: "{{ networks }}"
  loop_control:
    loop_var: network